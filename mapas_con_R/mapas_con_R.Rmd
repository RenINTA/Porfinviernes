---
title: "Haciendo mapas en R"
author: "Dr. Agustín Alesso"
institute: "Dept. of Crop Sciences | University of Illinois "
subtitle: "PoRfin VieRnes"
output: 
  xaringan::moon_reader:
    seal: false
    lib_dir: libs 
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: '16:9'
    css: ['styles.css', 'fonts.css', 'print.css']
    self_contained: true  #true para cuando se publica
editor_options: 
  chunk_output_type: console
---
class: title-slide, middle, hide-count, inverse
background-size: 15%
background-position: 10% 90%

```{r setup, include=FALSE}
#Packages
pacman::p_load(knitr, tidyverse, patchwork, xfun, tmap, leaflet, sp, DiagrammeR)
xaringanExtra::use_tile_view()
# xaringanExtra::use_clipboard()

htmltools::tagList(
  xaringanExtra::use_clipboard(
    button_text = "<i class=\"fa fa-clipboard\"></i>",
    success_text = "<i class=\"fa fa-check\" style=\"color: #90BE6D\"></i>",
  ),
  rmarkdown::html_dependency_font_awesome()
)

#Options
opts_chunk$set(
  echo = T, comment = NA, warning = FALSE, message = FALSE, fig.align = 'center', cache =T
)
options(width = 70)
tema <- theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())

# Functions
source(here::here("./mapas_con_R/out_lines.R"))
```

# `r rmarkdown::metadata$title`

<br>

## `r rmarkdown::metadata$author`
  
### `r rmarkdown::metadata$subtitle`

### `r rmarkdown::metadata$institute`


???

---
## Outline

.pull-left[

-   Por que hacer mapas? y porque en R?
-   Evolución datos espaciales en R
-   Mapas estáticos vs interactivos
-   base?
-   spplot
-   ggplot
-   tmap
-   leaflet
-   Referencias

]

???

--

.pull-right[

<br><br><br><br><br>
<br><br><br><br><br>

.small[

Codigo reproducible. You need to install/load these packages before run it.

```{r, eval = F}
install.packages("pacman")
pacman::p_load(tidyverse, rio, GGally, car, ggpmisc)
```

Or, you can try out the code using this r # embed_file("intro-to-mlr-notebook.Rmd", text = "R-notebook") `r fontawesome::fa("download")`

]

]


---
name: why-MLR

## ¿Por qué hacer mapas?

.pull-left[

```{r, echo = F, out.width="80%", fig.cap="Mapa de Cólera Londers 1854"}
include_graphics("https://upload.wikimedia.org/wikipedia/commons/c/c7/Snow-cholera-map.jpg")
```

]

???


Maps have been used for several thousand years for a wide variety of purposes. Historic examples include maps of buildings and land ownership in the Old Babylonian dynasty more than 3000 years ago and Ptolemy’s world map in his masterpiece Geography nearly 2000 years ago

En uno de los primeros análisis de datos espaciales el Dr. Snow mapeó los casos de cólera en el barrio Soho de Londres y la disposición de las estaciones de bombeo.

De la visualización de ambas capas de información descubró que el pozo contaminado se encontraba en la calle Broad.

--

.pull-right[


- Ideal para visualizar, explorar o analizar datos espaciales 

- Permiten ver tendencias, patrones, detectar anomalías, outliers, etc

- Modo efectivo para comunicar resultados de análisis de datos espaciales

{{content}}

]


???


Los mapas permien ver tendencias, patrones, valores extraños, etc

Ejemplo de tendencia

Ejemplo clásico pozos y colera


--

`r fontawesome::fa("exclamation-triangle")` **Cuidado**:

Mapas mal preparados pueden dificultar la comunicacion de resultados. Algunos problemas comunes:

- mala ubicación de los componnts

- tamaño y legibilidad del texto

- falta de referencias/leyenda

- mala elección de colores y simbología

`r fontawesome::fa("book")` Acá una guía de estilo de [Journal of Maps](https://files.taylorandfrancis.com/TJOM-suppmaterial-quick-guide.pdf)


???

---
name: spatial

## Datos espaciales en R: evolución 

```{r, echo = F, include = F}
# solo sp
grafico1 <- create_graph(attr_theme = "tb") |> 
  add_node(label = "sp")

# sp a maptools
grafico2 <- grafico1 |>  
  add_node(label = "maptools") |> 
  add_edge(from = 1, to = 2)

# sp rgeos/gdal
grafico3 <- grafico2 |>  
  add_node(label = "rgeos") |> 
  add_edge(from = 1, to = 3) |> 
  add_node(label = "rgdal") |> 
  add_edge(from = 1, to = 4)

# raster spacetime
grafico4 <- grafico3 |>  
  add_node(label = "raster") |> 
  add_edge(from = 1, to = 5) |> 
  add_node(label = "spacetime") |> 
  add_edge(from = 1, to = 6)

# sf
grafico5 <- grafico4 |>  
  add_node(label = "sf") |> 
  add_edge(from = 3, to = 7) |> 
  add_edge(from = 4, to = 7) 

# stars
grafico6 <- grafico5 |>  
  add_node(label = "stars") |> 
  add_edge(from = 5, to = 8) |> 
  add_edge(from = 6, to = 8) 

# terra
grafico7 <- grafico6 |>  
  add_node(label = "terra") |> 
  add_edge(from = 5, to = 9) 


```


.footnote[
Fuente: [R-Bloggers](https://www.r-bloggers.com/2023/06/upcoming-changes-to-popular-r-packages-for-spatial-data-what-you-need-to-do/), [Bivand et al. (2021)](https://link.springer.com/article/10.1007/s10109-020-00336-0#Sec2)

]

---
template: spatial

.pull-left[


```{r, echo = F, include = F}
# solo sp
grafico1 <- create_graph(attr_theme = "tb") |> 
  add_node(label = "sp")
render_graph(grafico1)
```

]

.pull-right[

Proveía las clases `Spatial*` y `Spatial*DataFrame` y sus métodos


```{r}
library(sp)
data(meuse)
coordinates(meuse) <- ~x+y
proj4string(meuse) <- CRS("+init=epsg:28992")
meuse
```

Slots para: `bbox`, `coords`, `proj4string` y `data` (los que `*DataFrame`


]


---
template: spatial

.pull-left[

```{r, echo = F}
# sp a maptools
grafico2 <- grafico1 |>  
  add_node(label = "maptools") |> 
  add_edge(from = 1, to = 2)
render_graph(grafico2)
```

]

.pull-right[

`maptools` utilidades varias (discontinuado)

]

---
template: spatial

.pull-left[

```{r, echo = F}
# sp rgeos/gdal
grafico3 <- grafico2 |>  
  add_node(label = "rgeos") |> 
  add_edge(from = 1, to = 3) |> 
  add_node(label = "rgdal") |> 
  add_edge(from = 1, to = 4) |> 
  add_node(label = "raster") |> 
  add_edge(from = 1, to = 5) |> 
  set_node_attrs(nodes = 2, node_attr = stype, value = "dashed")
render_graph(grafico3)
```

]

.pull-right[

`maptools` utilidades varias (discontinuado en )

`rgdal` para leer/guardardatos espaciales

`rgeos` para operar vectores

`raster` para operar rasters


]
---
template: spatial

.pull-left[

```{r, echo = F}
# raster spacetime
grafico4 <- grafico3 |>  
  add_node(label = "spacetime") |> 
  add_edge(from = 1, to = 6)
render_graph(grafico4)
```

]

.pull-right[

- Otros paquetes para con clases y metodos para objetos tipo raster y espacio-tiempo

]

---
template: spatial

.pull-left[

```{r, echo = F}
# sf
grafico5 <- grafico4 |>  
  add_node(label = "sf") |> 
  add_edge(from = 3, to = 7) |> 
  add_edge(from = 4, to = 7) 
render_graph(grafico5)
```


```{r, echo = F}
# stars
grafico6 <- grafico5 |>  
  add_node(label = "stars") |> 
  add_edge(from = 5, to = 8) |> 
  add_edge(from = 6, to = 8) 
render_graph(grafico6)
```


```{r, echo = F}
# terra
grafico7 <- grafico6 |>  
  add_node(label = "terra") |> 
  add_edge(from = 5, to = 9) 
render_graph(grafico7)
```

]

.pull-right[

Mas texto

]

---
template: spatial

.pull-left[

```{r, echo = F}
# sf
grafico5 <- grafico4 |>  
  add_node(label = "sf") |> 
  add_edge(from = 3, to = 7) |> 
  add_edge(from = 4, to = 7) 
render_graph(grafico5)
```


```{r, echo = F}
# stars
grafico6 <- grafico5 |>  
  add_node(label = "stars") |> 
  add_edge(from = 5, to = 8) |> 
  add_edge(from = 6, to = 8) 
render_graph(grafico6)
```


```{r, echo = F}
# terra
grafico7 <- grafico6 |>  
  add_node(label = "terra") |> 
  add_edge(from = 5, to = 9) 
render_graph(grafico7)
```

]

.pull-right[

Mas texto

]

---
template: spatial

.pull-left[

```{r, echo = F}
# sf
grafico5 <- grafico4 |>  
  add_node(label = "sf") |> 
  add_edge(from = 3, to = 7) |> 
  add_edge(from = 4, to = 7) 
render_graph(grafico5)
```


```{r, echo = F}
# stars
grafico6 <- grafico5 |>  
  add_node(label = "stars") |> 
  add_edge(from = 5, to = 8) |> 
  add_edge(from = 6, to = 8) 
render_graph(grafico6)
```


```{r, echo = F}
# terra
grafico7 <- grafico6 |>  
  add_node(label = "terra") |> 
  add_edge(from = 5, to = 9) 
render_graph(grafico7)
```

]

.pull-right[

Mas texto

]

---
## Mapas estáticos vs interactivos

.pull-left[

Al principio sólo podían hacerse mapas estaticos con R.

```{r}

```


]


---
### Paquetes para mapear

.pull-left[

-   base?

]

--

.pull-right[

]


-   spplot
-   ggplot
-   tmap
-   leaflet
-   Referencias
